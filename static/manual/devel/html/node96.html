<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<!--Converted with LaTeX2HTML 2008 (1.71)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>Module kpp: the KPP-turbulence model </TITLE>
<META NAME="description" CONTENT="Module kpp: the KPP-turbulence model ">
<META NAME="keywords" CONTENT="html">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META NAME="Generator" CONTENT="LaTeX2HTML v2008">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<LINK REL="STYLESHEET" HREF="html.css">

<LINK REL="next" HREF="node103.html">
<LINK REL="previous" HREF="node95.html">
<LINK REL="up" HREF="node36.html">
<LINK REL="next" HREF="node97.html">
</HEAD>

<BODY >

<DIV CLASS="navigation"><!--Navigation Panel-->
<A NAME="tex2html1646"
  HREF="node97.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next"
 SRC="/usr/share/latex2html/icons/next.png"></A> 
<A NAME="tex2html1642"
  HREF="node36.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up"
 SRC="/usr/share/latex2html/icons/up.png"></A> 
<A NAME="tex2html1636"
  HREF="node95.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous"
 SRC="/usr/share/latex2html/icons/prev.png"></A> 
<A NAME="tex2html1644"
  HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents"
 SRC="/usr/share/latex2html/icons/contents.png"></A>  
<BR>
<B> Next:</B> <A NAME="tex2html1647"
  HREF="node97.html">Initialise the KPP module</A>
<B> Up:</B> <A NAME="tex2html1643"
  HREF="node36.html">The turbulence model</A>
<B> Previous:</B> <A NAME="tex2html1637"
  HREF="node95.html">TKE flux from wave-breaking</A>
 &nbsp; <B>  <A NAME="tex2html1645"
  HREF="node1.html">Contents</A></B> 
<BR>
<BR></DIV>
<!--End of Navigation Panel-->

<H2><A NAME="SECTION000535000000000000000"></A><A NAME="sec:kpp"></A>
<BR>
Module kpp: the KPP-turbulence model 
</H2>

<P>

<P><P>
<BR>
<I CLASS="sans">INTERFACE:</I>
<PRE>   module kpp
</PRE>
<I CLASS="sans">DESCRIPTION:
<BR></I>

<P>
This implentation of the KPP turbulence parameterisation is based on the
  publications of <A
 HREF="node251.html#Largeetal94"><SPAN  CLASS="textit">Large et&nbsp;al.</SPAN> (1994)</A> and <A
 HREF="node251.html#Durskietal2004"><SPAN  CLASS="textit">Durksi et&nbsp;al.</SPAN> (2004)</A>.
  The general expression for the turbulent fluxes used in the KPP model is identical to
  that suggested in (<A HREF="node37.html#fluxes">45</A>). It assumes that the turbulent flux is the sum of a
  down-gradient flux and a non-local contribution,
  <P></P>
<DIV ALIGN="CENTER" CLASS="mathdisplay"><A NAME="kppFluxes"></A><!-- MATH
 \begin{equation}
{\langle w'\phi' \rangle}  = - \nu_t^\phi  \dfrac{\partial { {\langle \phi \rangle} }}{\partial {z}}  + \tilde{\Gamma}_\phi
   \; , \quad
\end{equation}
 -->
<TABLE CLASS="equation" CELLPADDING="0" WIDTH="100%" ALIGN="CENTER">
<TR VALIGN="MIDDLE">
<TD NOWRAP ALIGN="CENTER"><SPAN CLASS="MATH"><IMG
 WIDTH="195" HEIGHT="55" ALIGN="MIDDLE" BORDER="0"
 SRC="img720.png"
 ALT="$\displaystyle {\langle w'\phi' \rangle} = - \nu_t^\phi \dfrac{\partial { {\langle \phi \rangle} }}{\partial {z}} + \tilde{\Gamma}_\phi \; , \quad$"></SPAN></TD>
<TD NOWRAP CLASS="eqno" WIDTH="10" ALIGN="RIGHT">
(<SPAN CLASS="arabic">212</SPAN>)</TD></TR>
</TABLE></DIV>
<BR CLEAR="ALL"><P></P>
where the super- or subscript <SPAN CLASS="MATH"><IMG
 WIDTH="13" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img16.png"
 ALT="$ \phi$"></SPAN> is a placeholder for the symbols <SPAN CLASS="MATH"><IMG
 WIDTH="18" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img8.png"
 ALT="$ m$"></SPAN>, <SPAN CLASS="MATH"><IMG
 WIDTH="13" HEIGHT="15" ALIGN="BOTTOM" BORDER="0"
 SRC="img721.png"
 ALT="$ h$"></SPAN>, and <SPAN CLASS="MATH"><IMG
 WIDTH="11" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img722.png"
 ALT="$ s$"></SPAN>, indicating
  whether a quantity relates to momentum, heat, or salinity (or any other tracer), respectively.
  Note that turbulence parameters due to salinity stratification are updated only if the
  pre-processor macro <TT>KPP_SALINITY</TT> has been defined in <TT>cppdefs.h</TT>.

<P>
In the notation of the KPP model, the non-local flux is expressed as
  <P></P>
<DIV ALIGN="CENTER" CLASS="mathdisplay"><A NAME="kppNonlocal"></A><!-- MATH
 \begin{equation}
\tilde{\Gamma}_\phi = \nu_t^\phi \gamma_\phi
   \; , \quad
\end{equation}
 -->
<TABLE CLASS="equation" CELLPADDING="0" WIDTH="100%" ALIGN="CENTER">
<TR VALIGN="MIDDLE">
<TD NOWRAP ALIGN="CENTER"><SPAN CLASS="MATH"><IMG
 WIDTH="102" HEIGHT="39" ALIGN="MIDDLE" BORDER="0"
 SRC="img723.png"
 ALT="$\displaystyle \tilde{\Gamma}_\phi = \nu_t^\phi \gamma_\phi \; , \quad$"></SPAN></TD>
<TD NOWRAP CLASS="eqno" WIDTH="10" ALIGN="RIGHT">
(<SPAN CLASS="arabic">213</SPAN>)</TD></TR>
</TABLE></DIV>
<BR CLEAR="ALL"><P></P>
where independent models are valid for <!-- MATH
 $\nu_t^\phi$
 -->
<SPAN CLASS="MATH"><IMG
 WIDTH="21" HEIGHT="39" ALIGN="MIDDLE" BORDER="0"
 SRC="img724.png"
 ALT="$ \nu_t^\phi$"></SPAN> and <!-- MATH
 $\gamma_\phi$
 -->
<SPAN CLASS="MATH"><IMG
 WIDTH="20" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img725.png"
 ALT="$ \gamma_\phi$"></SPAN>.
  The KPP model assumes that the turbulent diffusivity, <!-- MATH
 $\nu_t^\phi$
 -->
<SPAN CLASS="MATH"><IMG
 WIDTH="21" HEIGHT="39" ALIGN="MIDDLE" BORDER="0"
 SRC="img724.png"
 ALT="$ \nu_t^\phi$"></SPAN>, inside the surface or
  bottom boundary layer is determined by a relation of the form
  <P></P>
<DIV ALIGN="CENTER" CLASS="mathdisplay"><A NAME="Kx"></A><!-- MATH
 \begin{equation}
\nu_t^\phi = h w_\phi(\sigma) G(\sigma)
   \; , \quad
\end{equation}
 -->
<TABLE CLASS="equation" CELLPADDING="0" WIDTH="100%" ALIGN="CENTER">
<TR VALIGN="MIDDLE">
<TD NOWRAP ALIGN="CENTER"><SPAN CLASS="MATH"><IMG
 WIDTH="153" HEIGHT="39" ALIGN="MIDDLE" BORDER="0"
 SRC="img726.png"
 ALT="$\displaystyle \nu_t^\phi = h w_\phi(\sigma) G(\sigma) \; , \quad$"></SPAN></TD>
<TD NOWRAP CLASS="eqno" WIDTH="10" ALIGN="RIGHT">
(<SPAN CLASS="arabic">214</SPAN>)</TD></TR>
</TABLE></DIV>
<BR CLEAR="ALL"><P></P>
where <SPAN CLASS="MATH"><IMG
 WIDTH="13" HEIGHT="15" ALIGN="BOTTOM" BORDER="0"
 SRC="img721.png"
 ALT="$ h$"></SPAN> denotes the thickness of the boundary layer, computed according
  to the algorithm discussed below.
  The non-dimensional boundary layer coordinate <SPAN CLASS="MATH"><IMG
 WIDTH="13" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img27.png"
 ALT="$ \sigma$"></SPAN> is defined according to
  <P></P>
<DIV ALIGN="CENTER" CLASS="mathdisplay"><A NAME="defSigma"></A><!-- MATH
 \begin{equation}
\sigma = \dfrac{d}{h}
   \; , \quad
\end{equation}
 -->
<TABLE CLASS="equation" CELLPADDING="0" WIDTH="100%" ALIGN="CENTER">
<TR VALIGN="MIDDLE">
<TD NOWRAP ALIGN="CENTER"><SPAN CLASS="MATH"><IMG
 WIDTH="72" HEIGHT="52" ALIGN="MIDDLE" BORDER="0"
 SRC="img727.png"
 ALT="$\displaystyle \sigma = \dfrac{d}{h} \; , \quad$"></SPAN></TD>
<TD NOWRAP CLASS="eqno" WIDTH="10" ALIGN="RIGHT">
(<SPAN CLASS="arabic">215</SPAN>)</TD></TR>
</TABLE></DIV>
<BR CLEAR="ALL"><P></P>
where <SPAN CLASS="MATH"><IMG
 WIDTH="12" HEIGHT="15" ALIGN="BOTTOM" BORDER="0"
 SRC="img440.png"
 ALT="$ d$"></SPAN> is the distance from the free surface (or the bottom boundary).
  The velocity scale, <SPAN CLASS="MATH"><IMG
 WIDTH="24" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img728.png"
 ALT="$ w_\phi$"></SPAN>, in (<A HREF="#Kx">214</A>) is computed as described in section <A HREF="node102.html#sec:wscale">4.35.6</A>. The
  dimensionless shape function <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="15" ALIGN="BOTTOM" BORDER="0"
 SRC="img41.png"
 ALT="$ G$"></SPAN> is a cubic polynomial,
  <P></P>
<DIV ALIGN="CENTER" CLASS="mathdisplay"><A NAME="GsigmaA"></A><!-- MATH
 \begin{equation}
G(\sigma) = a_0 + a_1 \sigma + a_2 \sigma^2 + a_3 \sigma^3
  \quad .
\end{equation}
 -->
<TABLE CLASS="equation" CELLPADDING="0" WIDTH="100%" ALIGN="CENTER">
<TR VALIGN="MIDDLE">
<TD NOWRAP ALIGN="CENTER"><SPAN CLASS="MATH"><IMG
 WIDTH="244" HEIGHT="37" ALIGN="MIDDLE" BORDER="0"
 SRC="img729.png"
 ALT="$\displaystyle G(\sigma) = a_0 + a_1 \sigma + a_2 \sigma^2 + a_3 \sigma^3 \quad .$"></SPAN></TD>
<TD NOWRAP CLASS="eqno" WIDTH="10" ALIGN="RIGHT">
(<SPAN CLASS="arabic">216</SPAN>)</TD></TR>
</TABLE></DIV>
<BR CLEAR="ALL"><P></P>
Physical arguments discussed in <A
 HREF="node251.html#Largeetal94"><SPAN  CLASS="textit">Large et&nbsp;al.</SPAN> (1994)</A> require  <SPAN CLASS="MATH"><IMG
 WIDTH="48" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img730.png"
 ALT="$ a_0=0$"></SPAN>, <SPAN CLASS="MATH"><IMG
 WIDTH="48" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img731.png"
 ALT="$ a_1=1$"></SPAN>. The remaining
  two parameters <SPAN CLASS="MATH"><IMG
 WIDTH="19" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img732.png"
 ALT="$ a_2$"></SPAN> and <SPAN CLASS="MATH"><IMG
 WIDTH="19" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img733.png"
 ALT="$ a_3$"></SPAN> may be re-expressed in terms of the value of <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="15" ALIGN="BOTTOM" BORDER="0"
 SRC="img41.png"
 ALT="$ G$"></SPAN> and its
  derivative, <SPAN CLASS="MATH"><IMG
 WIDTH="21" HEIGHT="16" ALIGN="BOTTOM" BORDER="0"
 SRC="img734.png"
 ALT="$ G'$"></SPAN>,  at the edge of the boundary layer, <SPAN CLASS="MATH"><IMG
 WIDTH="43" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img59.png"
 ALT="$ \sigma=1$"></SPAN>.
  Then, (<A HREF="#GsigmaA">216</A>) can be re-expressed as
  <P></P>
<DIV ALIGN="CENTER" CLASS="mathdisplay"><A NAME="GsigmaB"></A><!-- MATH
 \begin{equation}
G(\sigma) = \sigma \Big[
    1 + \sigma \Big(
      \left( \sigma - 2 \right)
    + \left( 3 - 2 \sigma  \right) G(1)
    + \left( \sigma - 1 \right) G'(1)
    \Big) \Big]
\end{equation}
 -->
<TABLE CLASS="equation" CELLPADDING="0" WIDTH="100%" ALIGN="CENTER">
<TR VALIGN="MIDDLE">
<TD NOWRAP ALIGN="CENTER"><SPAN CLASS="MATH"><IMG
 WIDTH="414" HEIGHT="45" ALIGN="MIDDLE" BORDER="0"
 SRC="img735.png"
 ALT="$\displaystyle G(\sigma) = \sigma \Big[ 1 + \sigma \Big( \left( \sigma - 2 \righ...
... \left( 3 - 2 \sigma \right) G(1) + \left( \sigma - 1 \right) G'(1) \Big) \Big]$"></SPAN></TD>
<TD NOWRAP CLASS="eqno" WIDTH="10" ALIGN="RIGHT">
(<SPAN CLASS="arabic">217</SPAN>)</TD></TR>
</TABLE></DIV>
<BR CLEAR="ALL"><P></P>
Apart from the boundary layer diffusivities, the KPP model also computes "interior"
  diffusivities, here denoted by <!-- MATH
 $\nu_{ti}^{\phi}$
 -->
<SPAN CLASS="MATH"><IMG
 WIDTH="22" HEIGHT="39" ALIGN="MIDDLE" BORDER="0"
 SRC="img736.png"
 ALT="$ \nu_{ti}^{\phi}$"></SPAN>. The function <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="15" ALIGN="BOTTOM" BORDER="0"
 SRC="img41.png"
 ALT="$ G$"></SPAN> and its derivative
  can be evaluted from the requirement that, at the edge of the boundary layer, the
  boundary layer diffusivity and its
  derivative correspond exactly to the interior diffusivity and its derivative,
  respectively.

<P>
Continuity of the boundary and interior diffusivites is obviously insured, see
  (<A HREF="#Kx">214</A>), if we require that
  <P></P>
<DIV ALIGN="CENTER" CLASS="mathdisplay"><A NAME="GOfOne"></A><!-- MATH
 \begin{equation}
G(1) = \dfrac{1}{h w_\phi(1)} \nu_{ti}^\phi(z_{bl})
   \; , \quad
\end{equation}
 -->
<TABLE CLASS="equation" CELLPADDING="0" WIDTH="100%" ALIGN="CENTER">
<TR VALIGN="MIDDLE">
<TD NOWRAP ALIGN="CENTER"><SPAN CLASS="MATH"><IMG
 WIDTH="184" HEIGHT="50" ALIGN="MIDDLE" BORDER="0"
 SRC="img737.png"
 ALT="$\displaystyle G(1) = \dfrac{1}{h w_\phi(1)} \nu_{ti}^\phi(z_{bl}) \; , \quad$"></SPAN></TD>
<TD NOWRAP CLASS="eqno" WIDTH="10" ALIGN="RIGHT">
(<SPAN CLASS="arabic">218</SPAN>)</TD></TR>
</TABLE></DIV>
<BR CLEAR="ALL"><P></P>
where <SPAN CLASS="MATH"><IMG
 WIDTH="22" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img738.png"
 ALT="$ z_{bl}$"></SPAN> denotes the vertical coordinate of the surface (or bottom) boundary layer.

<P>
A condition for the continuity of the derivatives of <!-- MATH
 $\nu_t^\phi$
 -->
<SPAN CLASS="MATH"><IMG
 WIDTH="21" HEIGHT="39" ALIGN="MIDDLE" BORDER="0"
 SRC="img724.png"
 ALT="$ \nu_t^\phi$"></SPAN> and <!-- MATH
 $\nu_{ti}^\phi$
 -->
<SPAN CLASS="MATH"><IMG
 WIDTH="22" HEIGHT="39" ALIGN="MIDDLE" BORDER="0"
 SRC="img739.png"
 ALT="$ \nu_{ti}^\phi$"></SPAN>
  can be obtained by carrying out the derivative with respect to <SPAN CLASS="MATH"><IMG
 WIDTH="12" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img20.png"
 ALT="$ z$"></SPAN> of (<A HREF="#Kx">214</A>), and
  setting it equal to the <SPAN CLASS="MATH"><IMG
 WIDTH="12" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img20.png"
 ALT="$ z$"></SPAN>-derivative of <!-- MATH
 $\nu_{ti}^\phi$
 -->
<SPAN CLASS="MATH"><IMG
 WIDTH="22" HEIGHT="39" ALIGN="MIDDLE" BORDER="0"
 SRC="img739.png"
 ALT="$ \nu_{ti}^\phi$"></SPAN>. For the surface layer
  this results in
  <P></P>
<DIV ALIGN="CENTER" CLASS="mathdisplay"><A NAME="GPrimeOfOne"></A><!-- MATH
 \begin{equation}
G'(1) = - \dfrac{G(1)}{w(1)} \dfrac{\partial {w}}{\partial {\sigma}} \Big|_{\sigma=1}
            - \dfrac{1}{w(1)} \dfrac{\partial {\nu_{ti}^\phi}}{\partial {z}} \Big|_{z=z_{bl}}
  \; , \quad
\end{equation}
 -->
<TABLE CLASS="equation" CELLPADDING="0" WIDTH="100%" ALIGN="CENTER">
<TR VALIGN="MIDDLE">
<TD NOWRAP ALIGN="CENTER"><SPAN CLASS="MATH"><IMG
 WIDTH="316" HEIGHT="62" ALIGN="MIDDLE" BORDER="0"
 SRC="img740.png"
 ALT="$\displaystyle G'(1) = - \dfrac{G(1)}{w(1)} \dfrac{\partial {w}}{\partial {\sigm...
...\dfrac{\partial {\nu_{ti}^\phi}}{\partial {z}} \Big\vert _{z=z_{bl}} \; , \quad$"></SPAN></TD>
<TD NOWRAP CLASS="eqno" WIDTH="10" ALIGN="RIGHT">
(<SPAN CLASS="arabic">219</SPAN>)</TD></TR>
</TABLE></DIV>
<BR CLEAR="ALL"><P></P>
where we used the relation
  <P></P>
<DIV ALIGN="CENTER" CLASS="mathdisplay"><A NAME="Dsigma"></A><!-- MATH
 \begin{equation}
\dfrac{\partial {}}{\partial {z}} = - \frac{1}{h} \dfrac{\partial {}}{\partial {\sigma}}
  \; , \quad
\end{equation}
 -->
<TABLE CLASS="equation" CELLPADDING="0" WIDTH="100%" ALIGN="CENTER">
<TR VALIGN="MIDDLE">
<TD NOWRAP ALIGN="CENTER"><SPAN CLASS="MATH"><IMG
 WIDTH="119" HEIGHT="52" ALIGN="MIDDLE" BORDER="0"
 SRC="img741.png"
 ALT="$\displaystyle \dfrac{\partial {}}{\partial {z}} = - \frac{1}{h} \dfrac{\partial {}}{\partial {\sigma}} \; , \quad$"></SPAN></TD>
<TD NOWRAP CLASS="eqno" WIDTH="10" ALIGN="RIGHT">
(<SPAN CLASS="arabic">220</SPAN>)</TD></TR>
</TABLE></DIV>
<BR CLEAR="ALL"><P></P>
if the motion of the free surface is ignored.

<P>
The derivative of <SPAN CLASS="MATH"><IMG
 WIDTH="24" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img728.png"
 ALT="$ w_\phi$"></SPAN> appearing in (<A HREF="#GPrimeOfOne">219</A>) can be evaluted with
  the help of the formulae given in section <A HREF="node102.html#sec:wscale">4.35.6</A>. As discussed in section <A HREF="node102.html#sec:wscale">4.35.6</A>,
  at <SPAN CLASS="MATH"><IMG
 WIDTH="43" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img59.png"
 ALT="$ \sigma=1$"></SPAN>, the derivative of <SPAN CLASS="MATH"><IMG
 WIDTH="24" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img728.png"
 ALT="$ w_\phi$"></SPAN> is different from zero only for stably
  stratified flows. Then, the non-dimensional function <SPAN CLASS="MATH"><IMG
 WIDTH="24" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img742.png"
 ALT="$ \Phi_\phi$"></SPAN> appearing
  in (<A HREF="node102.html#wscale">227</A>) is given by (<A HREF="node102.html#PhiStable">229</A>), and it is easy to show that
  <P></P>
<DIV ALIGN="CENTER" CLASS="mathdisplay"><A NAME="dWdS"></A><!-- MATH
 \begin{equation}
\dfrac{\partial {w}}{\partial {\sigma}} \Big|_{\sigma=1} =
     - 5 h w_\phi(1) \dfrac{B_f}{u_*^4}
  \; , \quad
\end{equation}
 -->
<TABLE CLASS="equation" CELLPADDING="0" WIDTH="100%" ALIGN="CENTER">
<TR VALIGN="MIDDLE">
<TD NOWRAP ALIGN="CENTER"><SPAN CLASS="MATH"><IMG
 WIDTH="198" HEIGHT="52" ALIGN="MIDDLE" BORDER="0"
 SRC="img743.png"
 ALT="$\displaystyle \dfrac{\partial {w}}{\partial {\sigma}} \Big\vert _{\sigma=1} = - 5 h w_\phi(1) \dfrac{B_f}{u_*^4} \; , \quad$"></SPAN></TD>
<TD NOWRAP CLASS="eqno" WIDTH="10" ALIGN="RIGHT">
(<SPAN CLASS="arabic">221</SPAN>)</TD></TR>
</TABLE></DIV>
<BR CLEAR="ALL"><P></P>
valid for both, bottom and surface boundary layers.
  Note that in the original publication of <A
 HREF="node251.html#Largeetal94"><SPAN  CLASS="textit">Large et&nbsp;al.</SPAN> (1994)</A>, erroneously,
  there appears an additional factor <SPAN CLASS="MATH"><IMG
 WIDTH="13" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img110.png"
 ALT="$ \kappa$"></SPAN> in this relation.

<P>
With the help of (<A HREF="#dWdS">221</A>), one can re-write (<A HREF="#GPrimeOfOne">219</A>) as
  <P></P>
<DIV ALIGN="CENTER" CLASS="mathdisplay"><A NAME="GPrimeOfOneB"></A><!-- MATH
 \begin{equation}
G'(1) = \dfrac{B_f}{u_*^4} \nu_{ti}^\phi \Big|_{z=z_{bl}}
            - \dfrac{1}{w(1)} \dfrac{\partial {\nu_{ti}^\phi}}{\partial {z}} \Big|_{z=z_{bl}}
  \; , \quad
\end{equation}
 -->
<TABLE CLASS="equation" CELLPADDING="0" WIDTH="100%" ALIGN="CENTER">
<TR VALIGN="MIDDLE">
<TD NOWRAP ALIGN="CENTER"><SPAN CLASS="MATH"><IMG
 WIDTH="292" HEIGHT="62" ALIGN="MIDDLE" BORDER="0"
 SRC="img744.png"
 ALT="$\displaystyle G'(1) = \dfrac{B_f}{u_*^4} \nu_{ti}^\phi \Big\vert _{z=z_{bl}} - ...
...\dfrac{\partial {\nu_{ti}^\phi}}{\partial {z}} \Big\vert _{z=z_{bl}} \; , \quad$"></SPAN></TD>
<TD NOWRAP CLASS="eqno" WIDTH="10" ALIGN="RIGHT">
(<SPAN CLASS="arabic">222</SPAN>)</TD></TR>
</TABLE></DIV>
<BR CLEAR="ALL"><P></P>
valid only for the surface boundary layer. For the bottom boundary layer,
  the minus sign in (<A HREF="#Dsigma">220</A>) disappears, with the consequence that
  the minus sign in (<A HREF="#GPrimeOfOneB">222</A>) has to be replaced by a plus. Note that
  if the pre-processor macro <TT>KPP_CLIP_GS</TT> is defined in <TT>cppdef.h</TT>,
  the slope of  <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="15" ALIGN="BOTTOM" BORDER="0"
 SRC="img41.png"
 ALT="$ G$"></SPAN> is set to zero for negative slopes. For stably stratified
  flows with a stabilizing buoyancy flux, this limiter breaks the continuity of
  the first derivatives.

<P>
The non-local transport term defined in (<A HREF="#kppNonlocal">213</A>) is computed
  as described in <A
 HREF="node251.html#Largeetal94"><SPAN  CLASS="textit">Large et&nbsp;al.</SPAN> (1994)</A>, if the pre-processor macro
  <TT>NONLOCAL</TT> is defined. Otherwise, non-local transport is ignored.

<P>
The position of the surface boundary layer depth, <SPAN CLASS="MATH"><IMG
 WIDTH="22" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img738.png"
 ALT="$ z_{bl}$"></SPAN>, corresponds
  to the position where the bulk Richardson number,
  <P></P>
<DIV ALIGN="CENTER" CLASS="mathdisplay"><A NAME="Rib"></A><!-- MATH
 \begin{equation}
Ri_b = \dfrac{(B_r - B(z_{bl})) d}
                 {| {\boldsymbol U}_r - {\boldsymbol U}(z_{bl}) |^2 + V_t^2(z_{bl})}
  \; , \quad
\end{equation}
 -->
<TABLE CLASS="equation" CELLPADDING="0" WIDTH="100%" ALIGN="CENTER">
<TR VALIGN="MIDDLE">
<TD NOWRAP ALIGN="CENTER"><SPAN CLASS="MATH"><IMG
 WIDTH="249" HEIGHT="55" ALIGN="MIDDLE" BORDER="0"
 SRC="img745.png"
 ALT="$\displaystyle Ri_b = \dfrac{(B_r - B(z_{bl})) d} {\vert {\boldsymbol U}_r - {\boldsymbol U}(z_{bl}) \vert^2 + V_t^2(z_{bl})} \; , \quad$"></SPAN></TD>
<TD NOWRAP CLASS="eqno" WIDTH="10" ALIGN="RIGHT">
(<SPAN CLASS="arabic">223</SPAN>)</TD></TR>
</TABLE></DIV>
<BR CLEAR="ALL"><P></P>
defined by <A
 HREF="node251.html#Largeetal94"><SPAN  CLASS="textit">Large et&nbsp;al.</SPAN> (1994)</A>, reaches the critical value <SPAN CLASS="MATH"><IMG
 WIDTH="28" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img291.png"
 ALT="$ Ri_c$"></SPAN>.
  The subscript "r" in (<A HREF="#Rib">223</A>) denotes a certain reference value of the buoyancy
  and velocity close to the surface. The choice of this reference value is
  not unique, and several possibilities have been implemented in numerical
  models. Presently, GOTM uses the uppermost grid point as the reference value.
  The bulk Richardson-number is then computed at the grid faces by linear
  interpolation of quantities defined at the centers (if
  <!-- MATH
 ${\tt KPP\_TWOPOINT\_REF}$
 -->
<SPAN CLASS="MATH"><IMG
 WIDTH="132" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img746.png"
 ALT="$ {\tt KPP\_TWOPOINT\_REF}$"></SPAN> is defined) or by simply identifying the
  neighbouring center-value with the value at the face.
  The "turbulent velocity shear", <SPAN CLASS="MATH"><IMG
 WIDTH="19" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img747.png"
 ALT="$ V_t$"></SPAN>, is computed as described
  by <A
 HREF="node251.html#Largeetal94"><SPAN  CLASS="textit">Large et&nbsp;al.</SPAN> (1994)</A>. The value of <SPAN CLASS="MATH"><IMG
 WIDTH="22" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img738.png"
 ALT="$ z_{bl}$"></SPAN> is then found from
  (<A HREF="#Rib">223</A>) by linear interpolation.

<P>
To check the boundary layer limit according to the condition
  <P></P>
<DIV ALIGN="CENTER" CLASS="mathdisplay"><A NAME="RiConditionA"></A><!-- MATH
 \begin{equation}
Ri_b(z_{bl})
    = \dfrac{Ri_\text{top}(z_{bl})}{Ri_\text{bot}(z_{bl})} = Ri_c
  \; , \quad
\end{equation}
 -->
<TABLE CLASS="equation" CELLPADDING="0" WIDTH="100%" ALIGN="CENTER">
<TR VALIGN="MIDDLE">
<TD NOWRAP ALIGN="CENTER"><SPAN CLASS="MATH"><IMG
 WIDTH="221" HEIGHT="55" ALIGN="MIDDLE" BORDER="0"
 SRC="img748.png"
 ALT="$\displaystyle Ri_b(z_{bl}) = \dfrac{Ri_\text{top}(z_{bl})}{Ri_\text{bot}(z_{bl})} = Ri_c \; , \quad$"></SPAN></TD>
<TD NOWRAP CLASS="eqno" WIDTH="10" ALIGN="RIGHT">
(<SPAN CLASS="arabic">224</SPAN>)</TD></TR>
</TABLE></DIV>
<BR CLEAR="ALL"><P></P>
two methods have been implemented in GOTM. The first method simply evaluates
  (<A HREF="#RiConditionA">224</A>) with a linear interpolation scheme.
  The second method is activated if the pre-processor
  macro <!-- MATH
 ${\tt KPP\_IP\_FC}$
 -->
<SPAN CLASS="MATH"><IMG
 WIDTH="74" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img749.png"
 ALT="$ {\tt KPP\_IP\_FC}$"></SPAN> is defined. Then, the condition (<A HREF="#RiConditionA">224</A>)
  is reformulated as
  <P></P>
<DIV ALIGN="CENTER" CLASS="mathdisplay"><A NAME="RiConditionB"></A><!-- MATH
 \begin{equation}
F_c(z_{bl}) = Ri_\text{top}(z_{bl})  - Ri_c Ri_\text{bot}(z_{bl}) = 0
  \quad .
\end{equation}
 -->
<TABLE CLASS="equation" CELLPADDING="0" WIDTH="100%" ALIGN="CENTER">
<TR VALIGN="MIDDLE">
<TD NOWRAP ALIGN="CENTER"><SPAN CLASS="MATH"><IMG
 WIDTH="90" HEIGHT="32" ALIGN="MIDDLE" BORDER="0"
 SRC="img750.png"
 ALT="$\displaystyle F_c(z_{bl}) = Ri_$">top<IMG
 WIDTH="96" HEIGHT="32" ALIGN="MIDDLE" BORDER="0"
 SRC="img751.png"
 ALT="$\displaystyle (z_{bl}) - Ri_c Ri_$">bot<IMG
 WIDTH="83" HEIGHT="32" ALIGN="MIDDLE" BORDER="0"
 SRC="img752.png"
 ALT="$\displaystyle (z_{bl}) = 0 \quad .$"></SPAN></TD>
<TD NOWRAP CLASS="eqno" WIDTH="10" ALIGN="RIGHT">
(<SPAN CLASS="arabic">225</SPAN>)</TD></TR>
</TABLE></DIV>
<BR CLEAR="ALL"><P></P>
The position where the function <SPAN CLASS="MATH"><IMG
 WIDTH="20" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img753.png"
 ALT="$ F_c$"></SPAN> changes sign is computed
  from linear interpolation.  This method has been suggested in the ROMS
  code as the numerically more stable alternative.
  Clearly, all approaches are grid-depending, a difficulty that cannot
  be overcome with the KPP model.

<P>
Finally, provided <TT>clip_mld=.true.</TT> in <TT>kpp.nml</TT>, the boundary layer is cut
  if it exceeds the Ekman or the Monin-Obukhov length scale, see <A
 HREF="node251.html#Largeetal94"><SPAN  CLASS="textit">Large et&nbsp;al.</SPAN> (1994)</A>.

<P>

<P><P>
<BR>
<EM>USES:</EM>
<PRE> 
  use turbulence,   only: num,nuh,nus
  use turbulence,   only: gamu,gamv,gamh,gams
  use turbulence,   only: Rig
  use turbulence,   only: kappa
 
 ifdef EXTRA_OUTPUT
  use turbulence,   only: turb1,turb2,turb3,turb4,turb5
 endif
 
   use eqstate
 
  IMPLICIT NONE
 
  private
</PRE><I CLASS="sans">PUBLIC MEMBER FUNCTIONS:</I>
<PRE>  public init_kpp, do_kpp, clean_kpp
</PRE><I CLASS="sans">PUBLIC DATA MEMBERS:</I>
<PRE>  z-position of surface boundary layer depth
  REALTYPE, public                 :: zsbl
 
  z-position of bottom boundary layer depth
  REALTYPE, public                 :: zbbl
</PRE><I CLASS="sans">DEFINED PARAMETERS:</I>
<PRE>   non-dimensional extent of the surface layer (epsilon=0.1)
   REALTYPE, parameter :: epsilon = 0.1
 
   critical gradient Richardson number below which turbulent
   mixing occurs (Ri0=0.7)
   REALTYPE, parameter :: Ri0     = 0.7
 
   value of double-diffusive density ratio where mixing goes
   to zero in salt fingering (Rrho0=1.9)
   REALTYPE, parameter :: Rrho0    = 1.9
 
   buoancy frequency (1/s2) limit for convection (bvfcon=-2.0E-5)
   REALTYPE, parameter :: bvfcon  = -2.0E-5
 
   scaling factor for double diffusion of temperature in salt
   fingering case (fdd=0.7)
   REALTYPE, parameter :: fdd     = 0.7
 
   maximum interior convective viscosity and diffusivity
   due to shear instability (nu0c=0.01)
   REALTYPE, parameter :: nu0c    = 0.01
 
   maximum interior viscosity (m2/s) due to shear
   instability (nu0m=10.0E-4)
   REALTYPE, parameter :: nu0m    = 10.0E-4
 
   maximum interior diffusivity (m2/s) due to shear
   instability (nu0s=10.0E-4)
   REALTYPE, parameter :: nu0s    = 10.0E-4
 
   scaling factor for double diffusion in salt fingering (nu=1.5E-6)
   REALTYPE, parameter :: nu      = 1.5E-6
 
   scaling factor for double diffusion in salt fingering (nuf=10.0E-4)
   REALTYPE, parameter :: nuf     = 10.0E-4
 
   interior viscosity (m2/s) due to wave breaking (nuwm=1.0E-5)
   REALTYPE, parameter :: nuwm    = 1.0E-5
 
   interior diffusivity (m2/s) due to wave breaking (nuwm=1.0E-6)
   REALTYPE, parameter :: nuws    = 1.0E-6
 
   double diffusion constant for salinity in diffusive
   convection case (sdd1=0.15)
   REALTYPE, parameter :: sdd1    = 0.15
 
   double diffusion constant for salinity in diffusive convection
   (sdd2=1.85)
   REALTYPE, parameter :: sdd2    = 1.85
 
   double diffusion constant for salinity in diffusive convection
   (sdd3=0.85)
   REALTYPE, parameter :: sdd3    = 0.85
 
   double diffusion constant for temperature in diffusive convection
   (tdd1=0.909)
   REALTYPE, parameter :: tdd1    = 0.909
 
   double diffusion constant for temperature in diffusive convection
   (tdd2=4.6)
   REALTYPE, parameter :: tdd2    = 4.6
 
   double diffusion constant for temperature in diffusive convection case
   (tdd3=0.54).
   REALTYPE, parameter :: tdd3    = 0.54
 
   proportionality coefficient parameterizing nonlocal  transport
   (Cstar=10.0)
   REALTYPE, parameter :: Cstar   = 10.0
 
   ratio of interior Brunt-Vaisala frequency to that
   at entrainment depth (Cv=1.5-1.6)
   REALTYPE, parameter :: Cv      = 1.6
 
   ratio of entrainment flux to surface buoyancy flux (betaT=-0.2)
   REALTYPE, parameter :: betaT   = -0.2
 
   constant for computation of Ekman scale (cekman=0.7)
   REALTYPE, parameter :: cekman  = 0.7
 
   constant for computation of Monin-Obukhov scale (cmonob  = 1.0)
   REALTYPE, parameter :: cmonob  = 1.0
 
   coefficient of flux profile for momentum in their
   1/3 power law regimes (am=1.26)
   REALTYPE, parameter :: am      = 1.257
 
   coefficient of flux profile for momentum in their
   1/3 power law regimes (as=-28.86)
   REALTYPE, parameter :: as      = -28.86
 
   coefficient of flux profile for momentum in their
   1/3 power law regimes (cm=8.38)
   REALTYPE, parameter :: cm      = 8.38
 
   coefficient of flux profile for momentum in their
   1/3 power law regimes (cs=98.96)
   REALTYPE, parameter :: cs      = 98.96
 
   maximum stability parameter "zeta" value of the 1/3
   power law regime of flux profile for momentum (zetam=-0.2)
   REALTYPE, parameter :: zetam   = -0.2
 
   maximum stability parameter "zeta" value of the 1/3
   power law regime of flux profile for tracers (zetas=-1.0)
   REALTYPE, parameter :: zetas   = -1.0
</PRE><I CLASS="sans">REVISION HISTORY:</I>
<PRE>   Original author(s): Lars Umlauf
</PRE><I CLASS="sans">LOCAL VARIABLES:</I>
<PRE>   proportionality coefficient for
   parameterizing non-local transport
   REALTYPE                              ::    Cg
 
   coefficient from computation of
   turbulent shear velocity
   REALTYPE                              ::    Vtc
 
   acceleration of gravity
   REALTYPE                              ::    g
 
   reference density
   REALTYPE                              ::    rho_0
 
   g/rho_0
   REALTYPE                              ::    gorho0
 
   critical bulk Richardson number
   REALTYPE                              ::    Ric
 
   compute surface and bottom BBL
   logical                               ::    kpp_sbl,kpp_bbl
 
   compute internal mixing
   logical                               ::    kpp_interior
 
   use clipping of MLD at Ekman and Monin-Oboukhov scale
   logical                               ::    clip_mld
 
   positions of grid faces and centers
   REALTYPE, dimension(:), allocatable   ::    z_w,z_r
 
   distance between centers
   REALTYPE, dimension(:), allocatable   ::    h_r
 
   integer                               ::    ksblOld
   REALTYPE                              ::    zsblOld
</PRE>

<P>

<P>
<BR><HR>
<!--Table of Child-Links-->
<A NAME="CHILD_LINKS"><STRONG>Subsections</STRONG></A>

<UL CLASS="ChildLinks">
<LI><A NAME="tex2html1648"
  HREF="node97.html">Initialise the KPP module</A>
<LI><A NAME="tex2html1649"
  HREF="node98.html">Loop over the KPP-algorithm</A>
<LI><A NAME="tex2html1650"
  HREF="node99.html">Compute interior fluxes </A>
<LI><A NAME="tex2html1651"
  HREF="node100.html">Compute turbulence in the surface layer </A>
<LI><A NAME="tex2html1652"
  HREF="node101.html">Compute turbulence in the bottom layer </A>
<LI><A NAME="tex2html1653"
  HREF="node102.html">Compute the velocity scale</A>
</UL>
<!--End of Table of Child-Links-->

<DIV CLASS="navigation"><HR>
<!--Navigation Panel-->
<A NAME="tex2html1646"
  HREF="node97.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next"
 SRC="/usr/share/latex2html/icons/next.png"></A> 
<A NAME="tex2html1642"
  HREF="node36.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up"
 SRC="/usr/share/latex2html/icons/up.png"></A> 
<A NAME="tex2html1636"
  HREF="node95.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous"
 SRC="/usr/share/latex2html/icons/prev.png"></A> 
<A NAME="tex2html1644"
  HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents"
 SRC="/usr/share/latex2html/icons/contents.png"></A>  
<BR>
<B> Next:</B> <A NAME="tex2html1647"
  HREF="node97.html">Initialise the KPP module</A>
<B> Up:</B> <A NAME="tex2html1643"
  HREF="node36.html">The turbulence model</A>
<B> Previous:</B> <A NAME="tex2html1637"
  HREF="node95.html">TKE flux from wave-breaking</A>
 &nbsp; <B>  <A NAME="tex2html1645"
  HREF="node1.html">Contents</A></B> </DIV>
<!--End of Navigation Panel-->
<ADDRESS>
Karsten Bolding
2012-12-28
</ADDRESS>
</BODY>
</HTML>
