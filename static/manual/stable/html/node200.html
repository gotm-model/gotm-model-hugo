<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<!--Converted with LaTeX2HTML 2008 (1.71)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>General ODE solver (Source File: ode_solvers.F90)</TITLE>
<META NAME="description" CONTENT="General ODE solver (Source File: ode_solvers.F90)">
<META NAME="keywords" CONTENT="html">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META NAME="Generator" CONTENT="LaTeX2HTML v2008">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<LINK REL="STYLESHEET" HREF="html.css">

<LINK REL="next" HREF="node201.html">
<LINK REL="previous" HREF="node199.html">
<LINK REL="up" HREF="node189.html">
<LINK REL="next" HREF="node201.html">
</HEAD>

<BODY >

<DIV CLASS="navigation"><!--Navigation Panel-->
<A NAME="tex2html3054"
  HREF="node201.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next"
 SRC="/usr/share/latex2html/icons/next.png"></A> 
<A NAME="tex2html3050"
  HREF="node189.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up"
 SRC="/usr/share/latex2html/icons/up.png"></A> 
<A NAME="tex2html3044"
  HREF="node199.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous"
 SRC="/usr/share/latex2html/icons/prev.png"></A> 
<A NAME="tex2html3052"
  HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents"
 SRC="/usr/share/latex2html/icons/contents.png"></A>  
<BR>
<B> Next:</B> <A NAME="tex2html3055"
  HREF="node201.html">First-order</A>
<B> Up:</B> <A NAME="tex2html3051"
  HREF="node189.html">Fortran: Module Interface time</A>
<B> Previous:</B> <A NAME="tex2html3045"
  HREF="node199.html">Lagrangian particle random walk</A>
 &nbsp; <B>  <A NAME="tex2html3053"
  HREF="node1.html">Contents</A></B> 
<BR>
<BR></DIV>
<!--End of Navigation Panel-->

<H3><A NAME="SECTION000951100000000000000"></A><A NAME="sec:ode-solver"></A>
<BR>
General ODE solver  (Source File: ode_solvers.F90)
</H3>

<P>

<P><P>
<BR>
<I CLASS="sans">INTERFACE:</I>
<PRE>    subroutine ode_solver(solver,numc,nlev,dt,cc,right_hand_side_rhs,right_hand_side_ppdd)
</PRE>
<I CLASS="sans">DESCRIPTION:
<BR></I>

<P>
Here, 10 different numerical solvers for the right hand sides of the
   biogeochemical models are implemented for computing the ordinary
   differential equations (ODEs) which are calculated as the second
   step of the operational split method for the complete biogeochemical
   models. The remaining ODE is
   <P></P>
<DIV ALIGN="CENTER" CLASS="mathdisplay"><A NAME="ODESystem"></A><!-- MATH
 \begin{equation}
\partial_t c_i
   =   P_i(\vec{c}) -D_i(\vec{c}), \;\; i = 1,\ldots,I,
\end{equation}
 -->
<TABLE CLASS="equation" CELLPADDING="0" WIDTH="100%" ALIGN="CENTER">
<TR VALIGN="MIDDLE">
<TD NOWRAP ALIGN="CENTER"><SPAN CLASS="MATH"><IMG
 WIDTH="242" HEIGHT="32" ALIGN="MIDDLE" BORDER="0"
 SRC="img839.png"
 ALT="$\displaystyle \partial_t c_i = P_i(\vec{c}) -D_i(\vec{c}), \;\; i = 1,\ldots,I,$"></SPAN></TD>
<TD NOWRAP CLASS="eqno" WIDTH="10" ALIGN="RIGHT">
(<SPAN CLASS="arabic">247</SPAN>)</TD></TR>
</TABLE></DIV>
<BR CLEAR="ALL"><P></P>
with <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img840.png"
 ALT="$ c_i$"></SPAN> denoting the concentrations of state variables.
   The right hand side denotes the reaction terms,
   which are composed of contributions
   <!-- MATH
 $d_{i,j}(\vec{c})$
 -->
<SPAN CLASS="MATH"><IMG
 WIDTH="46" HEIGHT="32" ALIGN="MIDDLE" BORDER="0"
 SRC="img841.png"
 ALT="$ d_{i,j}(\vec{c})$"></SPAN>, which represent reactive fluxes from
   <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img840.png"
 ALT="$ c_i$"></SPAN> to <SPAN CLASS="MATH"><IMG
 WIDTH="17" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img842.png"
 ALT="$ c_j$"></SPAN>, and in turn, <!-- MATH
 $p_{i,j}(\vec{c})$
 -->
<SPAN CLASS="MATH"><IMG
 WIDTH="46" HEIGHT="32" ALIGN="MIDDLE" BORDER="0"
 SRC="img843.png"
 ALT="$ p_{i,j}(\vec{c})$"></SPAN> are reactive fluxes from
   <SPAN CLASS="MATH"><IMG
 WIDTH="17" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img842.png"
 ALT="$ c_j$"></SPAN> received by <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img840.png"
 ALT="$ c_i$"></SPAN>, see equation (<A HREF="node215.html#eq:am:a">265</A>).

<P>
These methods are:

<P>

<OL>
<LI>First-order explicit (not unconditionally positive)
</LI>
<LI>Second order explicit Runge-Kutta (not unconditionally positive)
</LI>
<LI>Fourth-order explicit Runge-Kutta (not unconditionally positive)
</LI>
<LI>First-order Patankar (not conservative)
</LI>
<LI>Second-order Patankar-Runge-Kutta (not conservative)
</LI>
<LI>Fourth-order Patankar-Runge-Kutta (does not work, not conservative)
</LI>
<LI>First-order Modified Patankar (conservative and positive)
</LI>
<LI>Second-order Modified Patankar-Runge-Kutta (conservative and positive)
</LI>
<LI>Fourth-order Modified Patankar-Runge-Kutta
         (does not work, conservative and positive)
</LI>
<LI>First-order Extended Modified Patankar
         (stoichiometrically conservative and positive)
</LI>
<LI>Second-order Extended Modified Patankar-Runge-Kutta
         (stoichiometrically conservative and positive)
   
</LI>
</OL>

<P>
The schemes 1 - 5 and 7 - 8 have been described in detail by
   <A
 HREF="node251.html#Burchardetal2003b"><SPAN  CLASS="textit">Burchard et&nbsp;al.</SPAN> (2003)</A>. Later, <A
 HREF="node251.html#Bruggemanetal2005"><SPAN  CLASS="textit">Bruggeman et&nbsp;al.</SPAN> (2006)</A> could
   show that the Modified Patankar schemes 7 - 8 are only conservative
   for one limiting nutrient and therefore they developed the
   Extended Modified Patankar (EMP) schemes 10 and 11 which are also
   stoichiometrically conservative. Patankar and Modified Patankar
   schemes of fourth order have not yet been developed, such that
   choices 6 and 9 do not work yet.

<P>
The call to <TT>ode_solver()</TT> requires a little explanation. The
   first argument <TT>solver</TT> is an integer and specifies which solver
   to use. The arguments <TT>numc</TT> and <TT>nlev</TT> gives the dimensions
   of the data structure <TT>cc</TT> i.e. <TT>cc(1:numc,0:nlev)</TT>.
   <TT>dt</TT> is simply the time step. The last argument is the most
   complicated. <TT>right_hand_side</TT> is a subroutine with a fixed
   argument list. The subroutine evaluates the right hand side of the ODE
   and may be called more than once during one time-step - for higher order
   schemes. For an example of a correct <TT>right_hand_side</TT> have a look
   at e.g. <TT>do_bio_npzd()</TT>

<P>

<P><P>
<BR>
<EM>USES:</EM>
<PRE>    IMPLICIT NONE
</PRE><EM>INPUT PARAMETERS:</EM>
<PRE>    integer, intent(in)                 :: solver,nlev,numc
    REALTYPE, intent(in)                :: dt
   !INPUT/OUTPUT PARAMETER:
    REALTYPE, intent(inout)             :: cc(1:numc,0:nlev)
 
    interface
       subroutine right_hand_side_ppdd(first,numc,nlev,cc,pp,dd)
          logical, intent(in)                  :: first
          integer, intent(in)                  :: numc,nlev
          REALTYPE, intent(in)                 :: cc(1:numc,0:nlev)
 
          REALTYPE, intent(out)                :: pp(1:numc,1:numc,0:nlev)
          REALTYPE, intent(out)                :: dd(1:numc,1:numc,0:nlev)
       end
    end interface
 
    interface
       subroutine right_hand_side_rhs(first,numc,nlev,cc,rhs)
          logical, intent(in)                  :: first
          integer, intent(in)                  :: numc,nlev
          REALTYPE, intent(in)                 :: cc(1:numc,0:nlev)
          REALTYPE, intent(out)                :: rhs(1:numc,0:nlev)
       end
    end interface
</PRE><I CLASS="sans">REVISION HISTORY:</I>
<PRE>    Original author(s): Hans Burchard, Karsten Bolding
</PRE><I CLASS="sans">LOCAL VARIABLES:</I>
<PRE>
</PRE>

<P>

<P>

<DIV CLASS="navigation"><HR>
<!--Navigation Panel-->
<A NAME="tex2html3054"
  HREF="node201.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next"
 SRC="/usr/share/latex2html/icons/next.png"></A> 
<A NAME="tex2html3050"
  HREF="node189.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up"
 SRC="/usr/share/latex2html/icons/up.png"></A> 
<A NAME="tex2html3044"
  HREF="node199.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous"
 SRC="/usr/share/latex2html/icons/prev.png"></A> 
<A NAME="tex2html3052"
  HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents"
 SRC="/usr/share/latex2html/icons/contents.png"></A>  
<BR>
<B> Next:</B> <A NAME="tex2html3055"
  HREF="node201.html">First-order</A>
<B> Up:</B> <A NAME="tex2html3051"
  HREF="node189.html">Fortran: Module Interface time</A>
<B> Previous:</B> <A NAME="tex2html3045"
  HREF="node199.html">Lagrangian particle random walk</A>
 &nbsp; <B>  <A NAME="tex2html3053"
  HREF="node1.html">Contents</A></B> </DIV>
<!--End of Navigation Panel-->
<ADDRESS>
Karsten Bolding
2012-01-24
</ADDRESS>
</BODY>
</HTML>
