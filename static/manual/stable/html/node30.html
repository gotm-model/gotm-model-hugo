<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<!--Converted with LaTeX2HTML 2008 (1.71)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>The temperature equation (Source File: temperature.F90)</TITLE>
<META NAME="description" CONTENT="The temperature equation (Source File: temperature.F90)">
<META NAME="keywords" CONTENT="html">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META NAME="Generator" CONTENT="LaTeX2HTML v2008">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<LINK REL="STYLESHEET" HREF="html.css">

<LINK REL="next" HREF="node31.html">
<LINK REL="previous" HREF="node29.html">
<LINK REL="up" HREF="node19.html">
<LINK REL="next" HREF="node31.html">
</HEAD>

<BODY >

<DIV CLASS="navigation"><!--Navigation Panel-->
<A NAME="tex2html724"
  HREF="node31.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next"
 SRC="/usr/share/latex2html/icons/next.png"></A> 
<A NAME="tex2html720"
  HREF="node19.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up"
 SRC="/usr/share/latex2html/icons/up.png"></A> 
<A NAME="tex2html714"
  HREF="node29.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous"
 SRC="/usr/share/latex2html/icons/prev.png"></A> 
<A NAME="tex2html722"
  HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents"
 SRC="/usr/share/latex2html/icons/contents.png"></A>  
<BR>
<B> Next:</B> <A NAME="tex2html725"
  HREF="node31.html">The salinity equation (Source</A>
<B> Up:</B> <A NAME="tex2html721"
  HREF="node19.html">Fortran: Module Interface Mean</A>
<B> Previous:</B> <A NAME="tex2html715"
  HREF="node29.html">The vertical friction (Source</A>
 &nbsp; <B>  <A NAME="tex2html723"
  HREF="node1.html">Contents</A></B> 
<BR>
<BR></DIV>
<!--End of Navigation Panel-->

<H3><A NAME="SECTION000421100000000000000"></A><A NAME="sec:temperature"></A>
<BR>
The temperature equation  (Source File: temperature.F90)
</H3>

<P>

<P><P>
<BR>
<I CLASS="sans">INTERFACE:</I>
<PRE>    subroutine temperature(nlev,dt,cnpar,I_0,heat,nuh,gamh,rad)
</PRE>
<I CLASS="sans">DESCRIPTION:
<BR></I>

<P>
This subroutine computes the balance of heat in the form
    <P></P>
<DIV ALIGN="CENTER" CLASS="mathdisplay"><A NAME="TEq"></A><!-- MATH
 \begin{equation}
\dot{\Theta}
      = {\cal D}_\Theta
      - \frac{1}{\tau^\Theta_R}(\Theta-\Theta_{obs})
      + \frac{1}{C_p \rho_0} \dfrac{\partial {I}}{\partial {z}}
      \; , \quad
\end{equation}
 -->
<TABLE CLASS="equation" CELLPADDING="0" WIDTH="100%" ALIGN="CENTER">
<TR VALIGN="MIDDLE">
<TD NOWRAP ALIGN="CENTER"><SPAN CLASS="MATH"><IMG
 WIDTH="281" HEIGHT="52" ALIGN="MIDDLE" BORDER="0"
 SRC="img114.png"
 ALT="$\displaystyle \dot{\Theta} = {\cal D}_\Theta - \frac{1}{\tau^\Theta_R}(\Theta-\Theta_{obs}) + \frac{1}{C_p \rho_0} \dfrac{\partial {I}}{\partial {z}} \; , \quad$"></SPAN></TD>
<TD NOWRAP CLASS="eqno" WIDTH="10" ALIGN="RIGHT">
(<SPAN CLASS="arabic">27</SPAN>)</TD></TR>
</TABLE></DIV>
<BR CLEAR="ALL"><P></P>
where <!-- MATH
 $\dot{\Theta}$
 -->
<SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="21" ALIGN="BOTTOM" BORDER="0"
 SRC="img115.png"
 ALT="$ \dot{\Theta}$"></SPAN> denotes the material derivative of the mean  potential
    temperature <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="15" ALIGN="BOTTOM" BORDER="0"
 SRC="img13.png"
 ALT="$ \Theta$"></SPAN>, and
    <!-- MATH
 ${\cal D}_\Theta$
 -->
<SPAN CLASS="MATH"><IMG
 WIDTH="27" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img116.png"
 ALT="$ {\cal D}_\Theta$"></SPAN> is the sum of the turbulent and viscous transport
    terms modelled according to
    <P></P>
<DIV ALIGN="CENTER" CLASS="mathdisplay"><A NAME="DT"></A><!-- MATH
 \begin{equation}
{\cal D}_\Theta
      = \dfrac{\partial}{\partial {z}}
       \left(
          \left( \nu^\Theta_t + \nu^\Theta \right) \dfrac{\partial {\Theta}}{\partial {z}}
                 - \tilde{\Gamma}_\Theta
          \right)
      \quad .
\end{equation}
 -->
<TABLE CLASS="equation" CELLPADDING="0" WIDTH="100%" ALIGN="CENTER">
<TR VALIGN="MIDDLE">
<TD NOWRAP ALIGN="CENTER"><SPAN CLASS="MATH"><IMG
 WIDTH="259" HEIGHT="54" ALIGN="MIDDLE" BORDER="0"
 SRC="img117.png"
 ALT="$\displaystyle {\cal D}_\Theta = \dfrac{\partial}{\partial {z}} \left( \left( \n...
...\dfrac{\partial {\Theta}}{\partial {z}} - \tilde{\Gamma}_\Theta \right) \quad .$"></SPAN></TD>
<TD NOWRAP CLASS="eqno" WIDTH="10" ALIGN="RIGHT">
(<SPAN CLASS="arabic">28</SPAN>)</TD></TR>
</TABLE></DIV>
<BR CLEAR="ALL"><P></P>
In this equation, <!-- MATH
 $\nu^\Theta_t$
 -->
<SPAN CLASS="MATH"><IMG
 WIDTH="23" HEIGHT="35" ALIGN="MIDDLE" BORDER="0"
 SRC="img118.png"
 ALT="$ \nu^\Theta_t$"></SPAN> and <!-- MATH
 $\nu^\Theta$
 -->
<SPAN CLASS="MATH"><IMG
 WIDTH="23" HEIGHT="20" ALIGN="BOTTOM" BORDER="0"
 SRC="img119.png"
 ALT="$ \nu^\Theta$"></SPAN> are the turbulent and
    molecular diffusivities of heat, respectively, and <!-- MATH
 $\tilde{\Gamma}_\Theta$
 -->
<SPAN CLASS="MATH"><IMG
 WIDTH="24" HEIGHT="39" ALIGN="MIDDLE" BORDER="0"
 SRC="img120.png"
 ALT="$ \tilde{\Gamma}_\Theta$"></SPAN>
    denotes the non-local flux of heat, see section <A HREF="node36.html#sec:turbulenceIntro">4</A>.

<P>
Horizontal advection is optionally
    included  (see <TT>obs.nml</TT>) by means of prescribed
    horizontal gradients <!-- MATH
 $\partial_x\Theta$
 -->
<SPAN CLASS="MATH"><IMG
 WIDTH="33" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img96.png"
 ALT="$ \partial_x\Theta$"></SPAN> and <!-- MATH
 $\partial_y\Theta$
 -->
<SPAN CLASS="MATH"><IMG
 WIDTH="32" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img97.png"
 ALT="$ \partial_y\Theta$"></SPAN> and
    calculated horizontal mean velocities <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="15" ALIGN="BOTTOM" BORDER="0"
 SRC="img11.png"
 ALT="$ U$"></SPAN> and <SPAN CLASS="MATH"><IMG
 WIDTH="17" HEIGHT="15" ALIGN="BOTTOM" BORDER="0"
 SRC="img12.png"
 ALT="$ V$"></SPAN>.
    Relaxation with the time scale <!-- MATH
 $\tau^\Theta_R$
 -->
<SPAN CLASS="MATH"><IMG
 WIDTH="23" HEIGHT="35" ALIGN="MIDDLE" BORDER="0"
 SRC="img121.png"
 ALT="$ \tau^\Theta_R$"></SPAN>
    towards a precribed profile <!-- MATH
 $\Theta_{obs}$
 -->
<SPAN CLASS="MATH"><IMG
 WIDTH="35" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img122.png"
 ALT="$ \Theta_{obs}$"></SPAN>, changing in time, is possible.

<P>
The sum of latent, sensible, and longwave radiation is treated
    as a boundary condition. Solar radiation is treated as an inner
    source, <SPAN CLASS="MATH"><IMG
 WIDTH="32" HEIGHT="32" ALIGN="MIDDLE" BORDER="0"
 SRC="img123.png"
 ALT="$ I(z)$"></SPAN>. It is computed according the
    exponential law (see <A
 HREF="node251.html#PaulsonSimpson77"><SPAN  CLASS="textit">Paulson and Simpson</SPAN> (1977)</A>)
    <P></P>
<DIV ALIGN="CENTER" CLASS="mathdisplay"><A NAME="Iz"></A><!-- MATH
 \begin{equation}
I(z) = I_0 \bigg(Ae^{z/\eta_1}+(1-A)e^{z/\eta_2}\bigg)B(z).
\end{equation}
 -->
<TABLE CLASS="equation" CELLPADDING="0" WIDTH="100%" ALIGN="CENTER">
<TR VALIGN="MIDDLE">
<TD NOWRAP ALIGN="CENTER"><SPAN CLASS="MATH"><IMG
 WIDTH="280" HEIGHT="54" ALIGN="MIDDLE" BORDER="0"
 SRC="img124.png"
 ALT="$\displaystyle I(z) = I_0 \bigg(Ae^{z/\eta_1}+(1-A)e^{z/\eta_2}\bigg)B(z).$"></SPAN></TD>
<TD NOWRAP CLASS="eqno" WIDTH="10" ALIGN="RIGHT">
(<SPAN CLASS="arabic">29</SPAN>)</TD></TR>
</TABLE></DIV>
<BR CLEAR="ALL"><P></P>
The absorbtion coefficients <SPAN CLASS="MATH"><IMG
 WIDTH="19" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img125.png"
 ALT="$ \eta_1$"></SPAN> and <SPAN CLASS="MATH"><IMG
 WIDTH="19" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img126.png"
 ALT="$ \eta_2$"></SPAN> depend on the water type
    and have to be prescribed either by means of choosing a <A
 HREF="node251.html#Jerlov68"><SPAN  CLASS="textit">Jerlov</SPAN> (1968)</A> class
    (see <A
 HREF="node251.html#PaulsonSimpson77"><SPAN  CLASS="textit">Paulson and Simpson</SPAN> (1977)</A>) or by reading in a file through the namelist
    <TT>extinct</TT> in <TT>obs.nml</TT>. The damping term due to bioturbidity,
    <SPAN CLASS="MATH"><IMG
 WIDTH="37" HEIGHT="32" ALIGN="MIDDLE" BORDER="0"
 SRC="img127.png"
 ALT="$ B(z)$"></SPAN> is calculated in the biogeochemical routines, see section
    <A HREF="#sec:bio"><IMG  ALIGN="BOTTOM" BORDER="1" ALT="[*]"
 SRC="/usr/share/latex2html/icons/crossref.png"></A>.

<P>
Diffusion is numerically treated implicitly, see equations (<A HREF="node18.html#sigmafirst">7</A>)-
    (<A HREF="node18.html#sigmalast">9</A>).
    The tri-diagonal matrix is solved then by a simplified Gauss elimination.
    Vertical advection is included, and it must be non-conservative,
    which is ensured by setting the local variable <TT>adv_mode=0</TT>,
    see section <A HREF="node174.html#sec:advectionMean">8.2.3</A> on page <A HREF="node174.html#sec:advectionMean"><IMG  ALIGN="BOTTOM" BORDER="1" ALT="[*]"
 SRC="/usr/share/latex2html/icons/crossref.png"></A>.

<P>

<P><P>
<BR>
<EM>USES:</EM>
<PRE>    use meanflow,     only: avmolt,rho_0,cp
    use meanflow,     only: h,u,v,w,T,S,avh
    use meanflow,     only: bioshade
    use observations, only: dtdx,dtdy,t_adv
    use observations, only: w_adv_discr,w_adv_method
    use observations, only: tprof,TRelaxTau
    use observations, only: A,g1,g2
    use util,         only: Dirichlet,Neumann
    use util,         only: oneSided,zeroDivergence
 
    IMPLICIT NONE
</PRE><EM>INPUT PARAMETERS:</EM>
<PRE> 
    number of vertical layers
    integer, intent(in)                 :: nlev
 
    time step (s)
    REALTYPE, intent(in)                :: dt
 
    numerical "implicitness" parameter
    REALTYPE, intent(in)                :: cnpar
 
    surface short waves radiation  (W/m^2)
    REALTYPE, intent(in)                :: I_0
 
    surface heat flux (W/m^2)
    (negative for heat loss)
    REALTYPE, intent(in)                :: heat
 
    diffusivity of heat (m^2/s)
    REALTYPE, intent(in)                :: nuh(0:nlev)
 
    non-local heat flux (Km/s)
    REALTYPE, intent(in)                :: gamh(0:nlev)
</PRE><EM>OUTPUT PARAMETERS:</EM>
<PRE>    shortwave radiation profile (W/m^2)
    REALTYPE                            :: rad(0:nlev)
</PRE><I CLASS="sans">REVISION HISTORY:</I>
<PRE>    Original author(s): Hans Burchard &amp; Karsten Bolding
    $Log: temperature.F90,v $
    Revision 1.20  2010-07-28 15:09:46  hb
    Surface heat flux truncated when SST &lt; freezing temperature
    Revision 1.19  2008-03-07 17:57:49  hb
    AdvBcup changed to oneSided
    Revision 1.18  2007-01-06 11:49:16  kbk
    namelist file extension changed .inp --&gt; .nml
    Revision 1.17  2006-11-06 13:36:45  hb
    Option for conservative vertical advection added to adv_center
    Revision 1.16  2005-12-02 21:03:03  hb
    Documentation updated
    Revision 1.15  2005-11-17 09:58:20  hb
    explicit argument for positive definite variables in diff_center()
    Revision 1.14  2005/11/15 11:39:32  lars
    documentation finish for print
    Revision 1.13  2005/09/12 21:46:46  hb
    use of bioshade corrected (should work on short
    wave length part of light spectrum only)
    Revision 1.12  2005/06/27 13:44:07  kbk
    modified + removed traling blanks
    Revision 1.11  2004/08/18 12:31:52  lars
    updated documentation
    Revision 1.10  2004/07/28 11:29:10  hb
    Bug removed, rad is not any more multiplied with bioshade;
    bug found by Jorn Bruggeman, Amsterdam
    Revision 1.9  2003/07/23 12:33:21  hb
    fixed bioshade init and use
    Revision 1.7  2003/04/05 07:01:16  kbk
    moved bioshade variable to meanflow - to compile properly
    Revision 1.6  2003/04/04 14:25:52  hb
    First iteration of four-compartment geobiochemical model implemented
    Revision 1.5  2003/03/28 09:20:35  kbk
    added new copyright to files
    Revision 1.4  2003/03/28 08:56:56  kbk
    removed tabs
    Revision 1.3  2003/03/10 08:50:07  gotm
    Improved documentation and cleaned up code
    Revision 1.2  2001/11/18 11:50:37  gotm
    Cleaned
    Revision 1.1.1.1  2001/02/12 15:55:57  gotm
    initial import into CVS
</PRE>

<P>

<P>

<P>

<DIV CLASS="navigation"><HR>
<!--Navigation Panel-->
<A NAME="tex2html724"
  HREF="node31.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next"
 SRC="/usr/share/latex2html/icons/next.png"></A> 
<A NAME="tex2html720"
  HREF="node19.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up"
 SRC="/usr/share/latex2html/icons/up.png"></A> 
<A NAME="tex2html714"
  HREF="node29.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous"
 SRC="/usr/share/latex2html/icons/prev.png"></A> 
<A NAME="tex2html722"
  HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents"
 SRC="/usr/share/latex2html/icons/contents.png"></A>  
<BR>
<B> Next:</B> <A NAME="tex2html725"
  HREF="node31.html">The salinity equation (Source</A>
<B> Up:</B> <A NAME="tex2html721"
  HREF="node19.html">Fortran: Module Interface Mean</A>
<B> Previous:</B> <A NAME="tex2html715"
  HREF="node29.html">The vertical friction (Source</A>
 &nbsp; <B>  <A NAME="tex2html723"
  HREF="node1.html">Contents</A></B> </DIV>
<!--End of Navigation Panel-->
<ADDRESS>
Karsten Bolding
2012-01-24
</ADDRESS>
</BODY>
</HTML>
