<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<!--Converted with LaTeX2HTML 2008 (1.71)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>The vertical grid (Source File: updategrid.F90)</TITLE>
<META NAME="description" CONTENT="The vertical grid (Source File: updategrid.F90)">
<META NAME="keywords" CONTENT="html">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META NAME="Generator" CONTENT="LaTeX2HTML v2008">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<LINK REL="STYLESHEET" HREF="html.css">

<LINK REL="next" HREF="node24.html">
<LINK REL="previous" HREF="node22.html">
<LINK REL="up" HREF="node19.html">
<LINK REL="next" HREF="node24.html">
</HEAD>

<BODY >

<DIV CLASS="navigation"><!--Navigation Panel-->
<A NAME="tex2html640"
  HREF="node24.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next"
 SRC="/usr/share/latex2html/icons/next.png"></A> 
<A NAME="tex2html636"
  HREF="node19.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up"
 SRC="/usr/share/latex2html/icons/up.png"></A> 
<A NAME="tex2html630"
  HREF="node22.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous"
 SRC="/usr/share/latex2html/icons/prev.png"></A> 
<A NAME="tex2html638"
  HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents"
 SRC="/usr/share/latex2html/icons/contents.png"></A>  
<BR>
<B> Next:</B> <A NAME="tex2html641"
  HREF="node24.html">The Coriolis rotation (Source</A>
<B> Up:</B> <A NAME="tex2html637"
  HREF="node19.html">Fortran: Module Interface Mean</A>
<B> Previous:</B> <A NAME="tex2html631"
  HREF="node22.html">Print</A>
 &nbsp; <B>  <A NAME="tex2html639"
  HREF="node1.html">Contents</A></B> 
<BR>
<BR></DIV>
<!--End of Navigation Panel-->

<H3><A NAME="SECTION00042400000000000000"></A><A NAME="sec:updategrid"></A>
<BR>
The vertical grid  (Source File: updategrid.F90)
</H3>

<P>

<P><P>
<BR>
<I CLASS="sans">INTERFACE:</I>
<PRE>    subroutine updategrid(nlev,dt,zeta)
</PRE>
<I CLASS="sans">DESCRIPTION:
<BR></I>

<P>
This subroutine calculates for each time step new layer thicknesses
    in order to fit them to the changing water depth.
    Three different grids can be specified:
    
<OL>
<LI>Equidistant grid with possible zooming towards surface and bottom.
    The number of layers, <TT>nlev</TT>, and the zooming factors,
    <TT>ddu</TT>=<SPAN CLASS="MATH"><IMG
 WIDTH="20" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img61.png"
 ALT="$ d_u$"></SPAN> and  <TT>ddl</TT>=<SPAN CLASS="MATH"><IMG
 WIDTH="17" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img62.png"
 ALT="$ d_l$"></SPAN>,
    are specified in <TT>gotmmean.nml</TT>.
    Zooming is applied according to the formula
    <P></P>
<DIV ALIGN="CENTER" CLASS="mathdisplay"><A NAME="formula_Antoine"></A><!-- MATH
 \begin{equation}
h_k = D\frac{\mbox{tanh}\left( (d_l+d_u)\frac{k}{M}-d_l\right)
      +\mbox{tanh}(d_l)}{\mbox{tanh}(d_l)+\mbox{tanh}(d_u)}-1
     \quad .
\end{equation}
 -->
<TABLE CLASS="equation" CELLPADDING="0" WIDTH="100%" ALIGN="CENTER">
<TR VALIGN="MIDDLE">
<TD NOWRAP ALIGN="CENTER"><SPAN CLASS="MATH"><IMG
 WIDTH="344" HEIGHT="61" ALIGN="MIDDLE" BORDER="0"
 SRC="img63.png"
 ALT="$\displaystyle h_k = D\frac{\mbox{tanh}\left( (d_l+d_u)\frac{k}{M}-d_l\right) +\mbox{tanh}(d_l)}{\mbox{tanh}(d_l)+\mbox{tanh}(d_u)}-1 \quad .$"></SPAN></TD>
<TD NOWRAP CLASS="eqno" WIDTH="10" ALIGN="RIGHT">
(<SPAN CLASS="arabic">11</SPAN>)</TD></TR>
</TABLE></DIV>
<BR CLEAR="ALL"><P></P>

<P>
From this formula, the following grids are constructed:
    
<UL>
<LI><SPAN CLASS="MATH"><IMG
 WIDTH="84" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img64.png"
 ALT="$ d_l=d_u=0$"></SPAN> results in equidistant discretisations.
</LI>
<LI><!-- MATH
 $d_l>0, d_u=0$
 -->
<SPAN CLASS="MATH"><IMG
 WIDTH="99" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img65.png"
 ALT="$ d_l&gt;0, d_u=0$"></SPAN> results in zooming near the bottom.
</LI>
<LI><!-- MATH
 $d_l=0, d_u>0$
 -->
<SPAN CLASS="MATH"><IMG
 WIDTH="99" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img66.png"
 ALT="$ d_l=0, d_u&gt;0$"></SPAN> results in zooming near the surface.
</LI>
<LI><!-- MATH
 $d_l>0, d_u>0$
 -->
<SPAN CLASS="MATH"><IMG
 WIDTH="99" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img67.png"
 ALT="$ d_l&gt;0, d_u&gt;0$"></SPAN> results in double zooming nea both,
            the surface and the bottom.
    
</LI>
</UL>

<P>
</LI>
<LI>Sigma-layers. The fraction that every layer occupies is
    read-in from file, see <TT>gotmmean.nml</TT>.
</LI>
<LI>Cartesian layers. The height of every layer is read in from file,
    see <TT>gotmmean.nml</TT>.
    This method is not recommended when a varying sea surface is considered.
    
</LI>
</OL>

<P>
Furthermore, vertical velocity profiles are calculated here, if
    <TT>w_adv_method</TT> is 1 or 2, which has to be chosen in the
    <TT>w_advspec</TT> namelist in <TT>obs.nml</TT>. The profiles of vertical
    velocity are determined by two values,
    the height of maximum absolute value of vertical velocity, <TT>w_height</TT>,
    and the vertical velocity at this height, <TT>w_adv</TT>. From <TT>w_height</TT>,
    the vertical velocity is linearly decreasing towards the surface and
    the bottom, where is value is zero.

<P>

<P><P>
<BR>
<EM>USES:</EM>
<PRE>    use meanflow,     only: grid_ready
    use meanflow,     only: depth0,depth
    use meanflow,     only: ga,z,h,ho,ddu,ddl,grid_method
    use meanflow,     only: NN,SS,w_grid,grid_file,w
    use observations, only: zeta_method,w_adv_method
    use observations, only: w_adv,w_height,w_adv_discr
    IMPLICIT NONE
</PRE><EM>INPUT PARAMETERS:</EM>
<PRE>    integer, intent(in)                 :: nlev
    REALTYPE, intent(in)                :: dt,zeta
</PRE><I CLASS="sans">REVISION HISTORY:</I>
<PRE>    Original author(s): Hans Burchard &amp; Karsten Bolding
    $Log: updategrid.F90,v $
    Revision 1.20  2008-03-27 09:30:05  hb
    bug fix for w_height correction, bug found by Jorn Bruggeman
    Revision 1.19  2007-01-06 11:49:16  kbk
    namelist file extension changed .inp --&gt; .nml
    Revision 1.18  2006-11-27 15:26:37  kbk
    initialise grid depending on grid_ready
    Revision 1.17  2006-11-24 15:13:41  kbk
    de-allocate memory and close open files
    Revision 1.16  2005-11-18 10:59:35  kbk
    removed unused variables - some left in parameter lists
    Revision 1.15  2005/11/15 11:39:32  lars
    documentation finish for print
    Revision 1.14  2005/08/25 19:41:33  hb
    small deviations between depth and depth0 tolerated now
    Revision 1.13  2005/08/15 20:23:40  hb
    Vertical advection profiles triangle-shaped also for
    temporally constant vertical velocity
    Revision 1.12  2005/06/27 13:44:07  kbk
    modified + removed traling blanks
    Revision 1.11  2004/08/18 11:46:19  lars
    updated documentation
    Revision 1.10  2003/07/23 10:52:52  hb
    proper initialisation of gridinit + cleaning
    Revision 1.9  2003/03/28 09:20:35  kbk
    added new copyright to files
    Revision 1.8  2003/03/28 08:56:56  kbk
    removed tabs
    Revision 1.7  2003/03/10 13:43:42  lars
    double definitions removed - to conform with DEC compiler
    Revision 1.6  2003/03/10 08:50:08  gotm
    Improved documentation and cleaned up code
    Revision 1.5  2002/02/08 08:33:44  gotm
    Manuel added support for reading grid distribution from file
    Revision 1.4  2001/11/27 19:51:49  gotm
    Cleaned
    Revision 1.3  2001/11/27 15:38:06  gotm
    Possible to read coordinate distribution from file
    Revision 1.1.1.1  2001/02/12 15:55:57  gotm
    initial import into CVS
</PRE>

<P>

<P>

<P>

<DIV CLASS="navigation"><HR>
<!--Navigation Panel-->
<A NAME="tex2html640"
  HREF="node24.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next"
 SRC="/usr/share/latex2html/icons/next.png"></A> 
<A NAME="tex2html636"
  HREF="node19.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up"
 SRC="/usr/share/latex2html/icons/up.png"></A> 
<A NAME="tex2html630"
  HREF="node22.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous"
 SRC="/usr/share/latex2html/icons/prev.png"></A> 
<A NAME="tex2html638"
  HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents"
 SRC="/usr/share/latex2html/icons/contents.png"></A>  
<BR>
<B> Next:</B> <A NAME="tex2html641"
  HREF="node24.html">The Coriolis rotation (Source</A>
<B> Up:</B> <A NAME="tex2html637"
  HREF="node19.html">Fortran: Module Interface Mean</A>
<B> Previous:</B> <A NAME="tex2html631"
  HREF="node22.html">Print</A>
 &nbsp; <B>  <A NAME="tex2html639"
  HREF="node1.html">Contents</A></B> </DIV>
<!--End of Navigation Panel-->
<ADDRESS>
Karsten Bolding
2012-01-24
</ADDRESS>
</BODY>
</HTML>
